"use strict";(()=>{var e={};e.id=2,e.ids=[2],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4469:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>S,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>c});var s={};t.r(s),t.d(s,{POST:()=>l});var a=t(9303),i=t(8716),n=t(670),o=t(7070),u=t(5662);async function l(e){try{let{telegramId:r,telegramUsername:t,isPremium:s,nickname:a,tonWallet:i,referralCode:n}=await e.json();if(!r||!a)return o.NextResponse.json({error:"telegramId and nickname are required"},{status:400});let{data:l}=await u.O.from("User").select("*").eq("telegramId",String(r));if(l&&l.length>0){let e=l[0];if(null!=t&&String(t)!==(e.telegramUsername??"")){await u.O.from("User").update({telegramUsername:t||null}).eq("id",e.id);let{data:r}=await u.O.from("User").select("*").eq("id",e.id).single();return o.NextResponse.json({success:!0,user:r??e})}return o.NextResponse.json({success:!0,user:e})}let p=1;if(n&&"MASTER"!==n){let{data:e}=await u.O.from("User").select("id").eq("referralCode",String(n).toUpperCase()).single();e&&(p=e.id)}let d=String(a).toUpperCase().slice(0,10),{data:c,error:g}=await u.O.from("User").insert({telegramId:String(r),telegramUsername:t||null,nickname:a,referrerId:p,referralCode:d,isPremium:!!s,accountCreatedDate:new Date().toISOString(),tonWallet:null!=i&&""!==String(i).trim()?String(i).trim():"",role:"USER",isVerified:!0}).select().single();if(g)return console.error("Registration error:",g),o.NextResponse.json({error:g.message},{status:400});return o.NextResponse.json({success:!0,user:c})}catch(e){return console.error("Registration error:",e),o.NextResponse.json({error:"Registration failed"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"/Users/stanislavozarchuk/Projects/matrix-ton/frontend/app/api/auth/register/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:g}=p,m="/api/auth/register/route";function S(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:c})}},5662:(e,r,t)=>{t.d(r,{O:()=>i});var s=t(7857);let a=null,i=new Proxy({},{get:(e,r)=>(a||(a=function(){let e=process.env.SUPABASE_URL||"https://ovyukomdxoymgvqhztyv.supabase.co",r=process.env.SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92eXVrb21keG95bWd2cWh6dHl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1MDAxNjQsImV4cCI6MjA4NjA3NjE2NH0.GgbXI2Y99zK284PznjV8Cdi3TXZtSAzNFbX_JWtEjHk";return console.log("Creating Supabase client, URL:",e?e.substring(0,30)+"...":"EMPTY"),(0,s.eI)(e,r)}()),a[r])})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972,857],()=>t(4469));module.exports=s})();