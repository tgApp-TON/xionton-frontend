(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[394],{8924:function(){},5024:function(){},9558:function(e,r,t){"use strict";t.r(r),t.d(r,{RegisterClient:function(){return p}});var i=t(7437),n=t(2265),l=t(9376),o=t(141),a=t(6503),s=t(7710),d=t(8617),c=t(401),u=t(5805),m=t(1804),f=t(2489);let g=[{id:1,label:"Premium",icon:d.Z},{id:2,label:"Channel",icon:c.Z},{id:3,label:"Nickname",icon:u.Z},{id:4,label:"Wallet",icon:m.Z}];function p(){var e,r,t,p,h,b,x,v,y;let j=(0,l.useRouter)(),{user:S,isPremium:k,referralCode:C}=(0,s.f)(),w=(0,a.dD)(),[Z,z]=(0,n.useState)(1),[_,T]=(0,n.useState)(null),[R,B]=(0,n.useState)(null),[A,W]=(0,n.useState)(!1),[N,E]=(0,n.useState)(""),[I,P]=(0,n.useState)(null),[O,D]=(0,n.useState)(!1),[U,M]=(0,n.useState)(null),[J,q]=(0,n.useState)(!1),F=null!==(x=null===o.Z||void 0===o.Z?void 0:null===(r=o.Z.initDataUnsafe)||void 0===r?void 0:null===(e=r.user)||void 0===e?void 0:e.id)&&void 0!==x?x:null==S?void 0:S.id,L=null!==(v=null===o.Z||void 0===o.Z?void 0:null===(p=o.Z.initDataUnsafe)||void 0===p?void 0:null===(t=p.user)||void 0===t?void 0:t.username)&&void 0!==v?v:null==S?void 0:S.username,H=null!==(y=null===o.Z||void 0===o.Z?void 0:null===(b=o.Z.initDataUnsafe)||void 0===b?void 0:null===(h=b.user)||void 0===h?void 0:h.is_premium)&&void 0!==y?y:k;(0,n.useEffect)(()=>{var e,r,t;console.log("Telegram WebApp:",null===(e=window.Telegram)||void 0===e?void 0:e.WebApp),console.log("initDataUnsafe:",null===(t=window.Telegram)||void 0===t?void 0:null===(r=t.WebApp)||void 0===r?void 0:r.initDataUnsafe),console.log("user from useTelegram:",S),console.log("telegramId resolved:",F)},[]),(0,n.useEffect)(()=>{var e,r;null===o.Z||void 0===o.Z||null===(e=o.Z.ready)||void 0===e||e.call(o.Z),null===o.Z||void 0===o.Z||null===(r=o.Z.expand)||void 0===r||r.call(o.Z)},[]),(0,n.useEffect)(()=>{F&&fetch("/api/auth/me?telegramId=".concat(F)).then(e=>e.json()).then(e=>{if(e.exists){var r;(null===(r=e.user)||void 0===r?void 0:r.id)&&localStorage.setItem("matrix_ton_user_id",String(e.user.id)),j.replace("/tables")}}).catch(()=>{})},[F,j]),(0,n.useEffect)(()=>{null===_&&T(!!H)},[H,_]),(0,n.useEffect)(()=>{console.log("tonAddress changed:",w)},[w]);let $=async()=>{if(F){W(!0);try{let e=await fetch("/api/auth/check-channel?telegramId=".concat(F)),r=await e.json();B(r.subscribed)}catch(e){B(!1)}finally{W(!1)}}},V=async()=>{if(!N||!/^[a-zA-Z0-9_]{3,20}$/.test(N)){M("3-20 characters, letters, numbers, underscore only"),P(!1);return}if("master"===N){M("This nickname is reserved"),P(!1);return}D(!0),M(null);try{let e=await fetch("/api/auth/check-nickname?nickname=".concat(encodeURIComponent(N))),r=await e.json();P(r.available),r.available||M("This nickname is already taken")}catch(e){P(!1),M("Failed to check nickname")}finally{D(!1)}};(0,n.useEffect)(()=>{if(!N){P(null),M(null);return}let e=setTimeout(()=>{/^[a-zA-Z0-9_]{3,20}$/.test(N)&&"master"!==N?V():(P(null),N.length>0?M(N.length<3?"Min 3 characters":N.length>20?"Max 20 characters":"Letters, numbers, underscore only"):M(null))},400);return()=>clearTimeout(e)},[N]);let Y=async e=>{let r=void 0!==e?e:null!=w?w:"";if(console.log("handleRegister called with:",{telegramId:F,nickname:N,tonAddress:w,nicknameAvailable:I,walletToSend:r}),!F||!N){M("Missing required fields");return}q(!0);try{var t,i;let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({telegramId:String(F),telegramUsername:L||void 0,isPremium:H,nickname:N,tonWallet:r,referralCode:C||"MASTER"})}),n=await e.json();console.log("Register response status:",e.status),console.log("Register response data:",JSON.stringify(n)),n.success&&(null!=n.userId||(null===(t=n.user)||void 0===t?void 0:t.id)!=null)?(localStorage.setItem("matrix_ton_user_id",(null!==(i=n.userId)&&void 0!==i?i:n.user.id).toString()),j.replace("/tables")):M(n.error||"Registration failed")}catch(e){M("Registration failed")}finally{q(!1)}};(0,n.useEffect)(()=>{4===Z&&w&&N&&I&&!J&&Y()},[Z,w,N,I]);let G={position:"relative",zIndex:10,maxWidth:"420px",margin:"0 auto",padding:"2rem 1.5rem",background:"rgba(26, 26, 46, 0.85)",backdropFilter:"blur(20px)",borderRadius:"1.5rem",border:"1px solid rgba(139, 92, 246, 0.3)",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.4)"},K={width:"100%",boxSizing:"border-box",padding:"1rem 1.25rem",background:"rgba(15, 15, 35, 0.6)",border:"1px solid rgba(139, 92, 246, 0.3)",borderRadius:"0.75rem",color:"#ffffff",fontSize:"1rem",outline:"none"},Q={width:"100%",boxSizing:"border-box",padding:"1rem 1.5rem",background:"linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%)",border:"none",borderRadius:"0.75rem",color:"#ffffff",fontSize:"1rem",fontWeight:600,cursor:"pointer"},X={background:"#a855f7",color:"#ffffff",border:"none",borderRadius:"0.75rem",padding:"12px 32px",fontSize:"1rem",fontWeight:600,cursor:"pointer",marginTop:"1rem"};return F?(0,i.jsxs)("div",{className:"min-h-screen relative",style:{paddingTop:"70px"},children:[(0,i.jsx)("div",{style:{marginBottom:"2rem",textAlign:"center"},children:(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:"0.5rem",marginBottom:"1rem"},children:g.map(e=>{let r=e.icon,t=Z===e.id,n=Z>e.id;return(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem"},children:[(0,i.jsx)("div",{style:{width:"2.5rem",height:"2.5rem",borderRadius:"50%",background:n?"rgba(34, 197, 94, 0.2)":t?"rgba(139, 92, 246, 0.3)":"rgba(255,255,255,0.1)",border:"2px solid ".concat(n?"#22c55e":t?"#8b5cf6":"rgba(255,255,255,0.2)"),display:"flex",alignItems:"center",justifyContent:"center"},children:n?(0,i.jsx)(c.Z,{size:18,style:{color:"#22c55e"}}):(0,i.jsx)(r,{size:18,style:{color:t?"#8b5cf6":"#fff"}})}),(0,i.jsx)("span",{style:{fontSize:"0.7rem",color:"rgba(255,255,255,0.7)"},children:e.label})]},e.id)})})}),(0,i.jsxs)("div",{style:{padding:"0 1rem"},children:[1===Z&&(0,i.jsxs)("div",{style:G,children:[(0,i.jsxs)("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[(0,i.jsx)(d.Z,{size:48,style:{color:"#8b5cf6",marginBottom:"0.75rem"}}),(0,i.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:700,color:"#ffffff",marginBottom:"0.5rem"},children:"Telegram Premium"}),(0,i.jsx)("p",{style:{color:"rgba(255, 255, 255, 0.6)"},children:"Verifying your account..."})]}),null!==_&&(0,i.jsxs)("div",{style:{padding:"1rem",background:_?"rgba(34, 197, 94, 0.15)":"rgba(239, 68, 68, 0.15)",border:"1px solid ".concat(_?"rgba(34, 197, 94, 0.4)":"rgba(239, 68, 68, 0.4)"),borderRadius:"0.75rem",display:"flex",alignItems:"center",gap:"1rem"},children:[_?(0,i.jsx)(c.Z,{size:24,style:{color:"#22c55e"}}):(0,i.jsx)(f.Z,{size:24,style:{color:"#ef4444"}}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{style:{fontWeight:600,color:"#fff",margin:0},children:_?"Premium verified":"Premium required"}),(0,i.jsx)("p",{style:{fontSize:"0.875rem",color:"rgba(255,255,255,0.7)",margin:"0.25rem 0 0 0"},children:_?"You can continue":"Telegram Premium is required to join Matrix TON."})]})]}),null!==_&&(0,i.jsx)("button",{onClick:()=>z(2),style:X,children:"Continue →"})]}),2===Z&&(0,i.jsxs)("div",{style:G,children:[(0,i.jsxs)("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[(0,i.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:700,color:"#ffffff",marginBottom:"0.5rem"},children:"Channel Subscription"}),(0,i.jsx)("p",{style:{color:"rgba(255, 255, 255, 0.6)"},children:"Subscribe to @MatrixTON_Official"})]}),null!==R&&(0,i.jsxs)("div",{style:{padding:"1rem",background:R?"rgba(34, 197, 94, 0.15)":"rgba(239, 68, 68, 0.15)",border:"1px solid ".concat(R?"rgba(34, 197, 94, 0.4)":"rgba(239, 68, 68, 0.4)"),borderRadius:"0.75rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"1rem"},children:[R?(0,i.jsx)(c.Z,{size:24,style:{color:"#22c55e"}}):(0,i.jsx)(f.Z,{size:24,style:{color:"#ef4444"}}),(0,i.jsx)("p",{style:{margin:0,color:"#fff",fontWeight:600},children:R?"Subscribed ✓":"Not subscribed yet"})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[(0,i.jsx)("button",{onClick:$,disabled:A,style:Q,children:A?"Checking...":"Check"}),!0===R&&(0,i.jsx)("button",{onClick:()=>z(3),style:X,children:"Continue →"})]})]}),3===Z&&(0,i.jsxs)("div",{style:G,children:[(0,i.jsxs)("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[(0,i.jsx)(u.Z,{size:48,style:{color:"#8b5cf6",marginBottom:"0.75rem"}}),(0,i.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:700,color:"#ffffff",marginBottom:"0.5rem"},children:"Choose Nickname"}),(0,i.jsx)("p",{style:{color:"rgba(255, 255, 255, 0.6)"},children:"3-20 chars, letters, numbers, underscore"})]}),(0,i.jsx)("input",{type:"text",value:N,onChange:e=>E(e.target.value.replace(/[^a-zA-Z0-9_]/g,"").slice(0,20)),placeholder:"nickname",autoCapitalize:"none",autoCorrect:"off",style:{...K,marginBottom:"0.5rem",border:U?"1px solid rgba(239, 68, 68, 0.5)":I?"1px solid rgba(34, 197, 94, 0.5)":K.border},maxLength:20}),O&&(0,i.jsx)("p",{style:{fontSize:"0.75rem",color:"rgba(255,255,255,0.5)",margin:"0 0 1rem 0"},children:"Checking..."}),U&&!O&&(0,i.jsx)("p",{style:{fontSize:"0.75rem",color:"#ef4444",margin:"0 0 1rem 0"},children:U}),I&&!O&&(0,i.jsx)("p",{style:{fontSize:"0.75rem",color:"#22c55e",margin:"0 0 1rem 0"},children:"Available"}),(0,i.jsx)("button",{onClick:()=>{I&&z(4)},disabled:!I,style:{...Q,opacity:I?1:.5},children:"Continue"})]}),4===Z&&(0,i.jsxs)("div",{style:G,children:[(0,i.jsxs)("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[(0,i.jsx)(m.Z,{size:48,style:{color:"#8b5cf6",marginBottom:"0.75rem"}}),(0,i.jsx)("h2",{style:{fontSize:"1.5rem",fontWeight:700,color:"#ffffff",marginBottom:"0.5rem"},children:"Connect Wallet"}),(0,i.jsx)("p",{style:{color:"rgba(255, 255, 255, 0.6)"},children:"Connect your TON wallet to complete registration"})]}),(0,i.jsx)("div",{style:{display:"flex",justifyContent:"center",marginBottom:"1rem"},children:(0,i.jsx)(a.P6,{})}),J&&(0,i.jsx)("p",{style:{textAlign:"center",color:"rgba(255,255,255,0.7)"},children:"Registering..."}),w&&!J&&(0,i.jsx)("button",{onClick:()=>Y(),style:{background:"#a855f7",color:"#ffffff",border:"none",borderRadius:"0.75rem",padding:"12px 32px",fontSize:"1rem",fontWeight:600,cursor:"pointer",marginTop:"1rem"},children:"Complete Registration"}),!J&&(0,i.jsx)("button",{onClick:()=>Y(""),style:{background:"transparent",color:"rgba(255,255,255,0.7)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"0.75rem",padding:"12px 32px",fontSize:"1rem",cursor:"pointer",marginTop:"0.75rem"},children:"Skip for now →"})]})]})]}):(0,i.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center",style:{padding:"2rem"},children:[(0,i.jsx)("p",{style:{color:"rgba(255,255,255,0.9)",fontSize:"1.125rem",textAlign:"center",marginBottom:"1.5rem"},children:"Please open this app through Telegram bot @MatrixTON_Bot"}),(0,i.jsx)("a",{href:"https://t.me/MatrixTON_Bot",target:"_blank",rel:"noopener noreferrer",style:{padding:"1rem 1.5rem",background:"linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%)",borderRadius:"0.75rem",color:"#fff",fontWeight:600,textDecoration:"none"},children:"t.me/MatrixTON_Bot"})]})}},7710:function(e,r,t){"use strict";t.d(r,{TelegramProvider:function(){return o},f:function(){return a}});var i=t(7437),n=t(2265);let l=(0,n.createContext)({user:null,webApp:null,isReady:!1,isPremium:!1,referralCode:null});function o(e){var r;let{children:t}=e,[o,a]=(0,n.useState)(null),[s,d]=(0,n.useState)(!1),[c,u]=(0,n.useState)(null);(0,n.useEffect)(()=>{var e;let r;let t=()=>{var e,i;let n=null===(e=window.Telegram)||void 0===e?void 0:e.WebApp,l=null==n?void 0:n.initDataUnsafe,o=null==l?void 0:l.user;if(console.log("userFromUnsafe:",JSON.stringify(o)),console.log("initDataUnsafe full:",JSON.stringify(l)),n&&o){n.ready(),n.expand(),n.setHeaderColor("#000000"),n.setBackgroundColor("#000000"),a({id:o.id,first_name:o.first_name,last_name:o.last_name,username:o.username,language_code:o.language_code,is_premium:o.is_premium});let e=null!==(i=null==l?void 0:l.start_param)&&void 0!==i?i:null;e&&u(e),d(!0)}else if(n){n.ready(),n.expand(),n.setHeaderColor("#000000"),n.setBackgroundColor("#000000"),r=setTimeout(t,500);return}else{a(null);let e=new URLSearchParams(window.location.search),r=null==e?void 0:e.get("ref");r&&u(r),d(!0)}};t();let i=null===(e=window.Telegram)||void 0===e?void 0:e.WebApp;return(null==i?void 0:i.onEvent)&&i.onEvent("viewport_changed",t),()=>{r&&clearTimeout(r),(null==i?void 0:i.offEvent)&&i.offEvent("viewport_changed",t)}},[]);let m={user:o,webApp:null===(r=window.Telegram)||void 0===r?void 0:r.WebApp,isReady:s,isPremium:(null==o?void 0:o.is_premium)||!1,referralCode:c};return(0,i.jsx)(l.Provider,{value:m,children:t})}let a=()=>(0,n.useContext)(l)}}]);